<Window x:Class="OpenJPDF.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"

        xmlns:vm="clr-namespace:OpenJPDF.ViewModels"
        xmlns:models="clr-namespace:OpenJPDF.Models"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="800" Width="1400"
        MinHeight="600" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Icon="pack://application:,,,/Assets/pomeranian_icon.ico"
        Background="{StaticResource BackgroundBrush}">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" x:Name="MenuRow"/>
            <RowDefinition Height="Auto" x:Name="ToolbarRow"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto" x:Name="StatusRow"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" x:Name="MenuBar" Background="{StaticResource SurfaceBrush}" Padding="4">
            <MenuItem Header="_File">
                <MenuItem Header="_Open PDF" Command="{Binding OpenFileCommand}" InputGestureText="Ctrl+O"/>
                <MenuItem Header="_Save" Command="{Binding SaveCommand}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="Save _As..." Command="{Binding SaveAsCommand}" InputGestureText="Ctrl+Shift+S"/>
                <Separator/>
                <MenuItem Header="_Exit" Command="{Binding ExitCommand}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" Command="{Binding UndoCommand}" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="_Redo" Command="{Binding RedoCommand}" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="Add _Text" Command="{Binding AddTextCommand}"/>
                <MenuItem Header="Add _Image" Command="{Binding AddImageCommand}"/>
                <Separator/>
                <MenuItem Header="_Scan to Add Image" Command="{Binding ScanDocumentCommand}" ToolTip="Scan and add as image to current PDF"/>
                <MenuItem Header="Scan to _New PDF" Command="{Binding ScanToNewPdfCommand}" ToolTip="Scan and create a new PDF file"/>
                <Separator/>
                <MenuItem Header="_Delete Selected" Command="{Binding DeleteSelectedCommand}" InputGestureText="Del"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Merge PDFs" Command="{Binding MergePdfCommand}"/>
                <MenuItem Header="_Split PDF" Command="{Binding SplitPdfCommand}"/>
                <MenuItem Header="Extract _Pages" Command="{Binding ExtractPagesCommand}"/>
                <Separator/>
                <MenuItem Header="_Header/Footer..." Command="{Binding OpenHeaderFooterDialogCommand}"/>
                <MenuItem Header="Clear Header/Footer" Command="{Binding ClearHeaderFooterCommand}"/>
                <Separator/>
                <MenuItem Header="Rotate _Left" Command="{Binding RotatePageLeftCommand}" InputGestureText="Ctrl+L"/>
                <MenuItem Header="Rotate _Right" Command="{Binding RotatePageRightCommand}" InputGestureText="Ctrl+R"/>
                <MenuItem Header="_Duplicate Page" Command="{Binding DuplicatePageCommand}" InputGestureText="Ctrl+D"/>
                <MenuItem Header="D_elete Page" Command="{Binding DeletePageCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Command="{Binding AboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border Grid.Row="1" x:Name="Toolbar" Background="{StaticResource SurfaceBrush}" Padding="8,4" 
                BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <WrapPanel Orientation="Horizontal">
                <!-- File Operations -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding OpenFileCommand}" ToolTip="Open PDF (Ctrl+O)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‚" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Open"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding SaveCommand}" ToolTip="Save (Ctrl+S)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ’¾" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Save"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- View/Edit Mode Toggle -->
                <Border CornerRadius="4" Padding="2" Margin="0,0,8,0">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Background" Value="Transparent"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                    <Setter Property="Background" Value="#E3F2FD"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Button Style="{StaticResource ToolbarButton}" 
                            Command="{Binding ToggleViewEditModeCommand}" 
                            ToolTip="Toggle View/Edit Mode (F2)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding ViewEditModeIcon}" FontSize="16" Margin="0,0,4,0"/>
                            <TextBlock Text="{Binding ViewEditModeText}" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </Border>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Undo/Redo -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding UndoCommand}" 
                        IsEnabled="{Binding CanUndo}" ToolTip="{Binding UndoDescription, StringFormat='Undo: {0} (Ctrl+Z)', FallbackValue='Undo (Ctrl+Z)'}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â†©ï¸" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Undo"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding RedoCommand}" 
                        IsEnabled="{Binding CanRedo}" ToolTip="{Binding RedoDescription, StringFormat='Redo: {0} (Ctrl+Y)', FallbackValue='Redo (Ctrl+Y)'}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â†ªï¸" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Redo"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Navigation -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding PreviousPageCommand}" ToolTip="Previous Page">
                    <TextBlock Text="â—€" FontSize="14"/>
                </Button>
                <TextBox Width="50" Text="{Binding CurrentPageNumber, UpdateSourceTrigger=PropertyChanged}" 
                         VerticalContentAlignment="Center" HorizontalContentAlignment="Center"
                         Margin="4,0"/>
                <TextBlock Text="/" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalPages}" VerticalAlignment="Center" Margin="4,0"/>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding NextPageCommand}" ToolTip="Next Page">
                    <TextBlock Text="â–¶" FontSize="14"/>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Zoom -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ZoomOutCommand}" ToolTip="Zoom Out">
                    <TextBlock Text="ðŸ”âˆ’" FontSize="14"/>
                </Button>
                <ComboBox x:Name="ZoomComboBox" Width="80" Margin="4,0"
                          VerticalContentAlignment="Center"
                          ItemsSource="{Binding ZoomLevels}"
                          SelectedItem="{Binding ZoomLevel, Mode=TwoWay}"/>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ZoomInCommand}" ToolTip="Zoom In">
                    <TextBlock Text="ðŸ”+" FontSize="14"/>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Edit Tools -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding AddTextCommand}" ToolTip="Add Text">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Add Text"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding AddImageCommand}" ToolTip="Add Image">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ–¼ï¸" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Add Image"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ScanDocumentCommand}" ToolTip="Scan and add as image to current page">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ–¨ï¸" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Scan+"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ScanToNewPdfCommand}" ToolTip="Scan and create new PDF">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“ " FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Scan New"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Shape Tools -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding AddRectangleCommand}" ToolTip="Add Rectangle">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â–­" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Rectangle"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding AddEllipseCommand}" ToolTip="Add Ellipse">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â¬­" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Ellipse"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding AddLineCommand}" ToolTip="Add Line">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â•±" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Line"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- OCR Select Tool -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding SelectTextCommand}" ToolTip="Select text region for OCR (drag to select area)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Select Text"/>
                    </StackPanel>
                </Button>
                
                <!-- Screen Capture Tool -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ScreenCaptureCommand}" ToolTip="Capture screen region as image (drag to select area)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“·" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Capture"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Content Extraction Tool -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ExtractPageContentCommand}" ToolTip="Extract and edit existing content from PDF">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‹" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Extract"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ClearExtractedContentCommand}"
                        Visibility="{Binding IsContentExtracted, Converter={StaticResource BoolToVisibility}}"
                        ToolTip="Clear extracted content">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âŒ" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Clear"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- Header/Footer Tool -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding OpenHeaderFooterDialogCommand}" ToolTip="Add Header/Footer to pages">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“„" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Header/Footer"/>
                    </StackPanel>
                </Button>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,4"/>

                <!-- PDF Tools -->
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding MergePdfCommand}" ToolTip="Merge PDFs">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‘" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Merge"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding ExtractPagesCommand}" ToolTip="Extract Pages to New PDF">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“¤" FontSize="16" Margin="0,0,4,0"/>
                        <TextBlock Text="Extract"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding RotatePageLeftCommand}" ToolTip="Rotate Left (Counter-clockwise 90Â°)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â†º" FontSize="18" Margin="0,0,4,0"/>
                        <TextBlock Text="Rotate Left"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolbarButton}" Command="{Binding RotatePageRightCommand}" ToolTip="Rotate Right (Clockwise 90Â°)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â†»" FontSize="18" Margin="0,0,4,0"/>
                        <TextBlock Text="Rotate Right"/>
                    </StackPanel>
                </Button>
            </WrapPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2" x:Name="MainContent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" MinWidth="150" x:Name="LeftPanelColumn"/>
                <ColumnDefinition Width="Auto" x:Name="LeftSplitterColumn"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto" x:Name="RightSplitterColumn"/>
                <ColumnDefinition Width="280" MinWidth="200" x:Name="RightPanelColumn"/>
            </Grid.ColumnDefinitions>

            <!-- Page Thumbnails Panel -->
            <Border Grid.Column="0" x:Name="LeftPanel" Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                <DockPanel>
                    <!-- Header with selection count -->
                    <Border DockPanel.Dock="Top" Background="#F0F0F0" Padding="12,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Pages" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding SelectedPagesCount, StringFormat='Selected: {0}'}" 
                                       FontSize="11" Foreground="#666666"
                                       Visibility="{Binding HasMultipleSelection, Converter={StaticResource BoolToVisibility}}"/>
                        </Grid>
                    </Border>
                    
                    <ListBox x:Name="ThumbnailListBox"
                             ItemsSource="{Binding PageThumbnails}" 
                             SelectedIndex="{Binding CurrentPageIndex}"
                             SelectedItem="{Binding SelectedThumbnail}"
                             SelectionMode="Extended"
                             Background="Transparent"
                             BorderThickness="0"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             AllowDrop="True"
                             SelectionChanged="ThumbnailListBox_SelectionChanged"
                             PreviewMouseLeftButtonDown="ThumbnailListBox_PreviewMouseLeftButtonDown"
                             PreviewMouseMove="ThumbnailListBox_PreviewMouseMove"
                             PreviewKeyDown="ThumbnailListBox_PreviewKeyDown"
                             Drop="ThumbnailListBox_Drop"
                             DragOver="ThumbnailListBox_DragOver"
                             DragLeave="ThumbnailListBox_DragLeave">
                        <ListBox.ContextMenu>
                            <ContextMenu>
                                <!-- Selection Commands -->
                                <MenuItem Header="Select All" Command="{Binding SelectAllPagesCommand}" InputGestureText="Ctrl+A">
                                    <MenuItem.Icon>
                                        <TextBlock Text="â˜‘" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Clear Selection" Command="{Binding ClearPageSelectionCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="â˜" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator/>
                                
                                <!-- Multi-Select Batch Operations -->
                                <MenuItem Header="Rotate Selected Right" Command="{Binding RotateSelectedPagesRightCommand}" InputGestureText="Ctrl+R">
                                    <MenuItem.Icon>
                                        <TextBlock Text="â†»" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Rotate Selected Left" Command="{Binding RotateSelectedPagesLeftCommand}" InputGestureText="Ctrl+L">
                                    <MenuItem.Icon>
                                        <TextBlock Text="â†º" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator/>
                                <MenuItem Header="Move Selected Up" Command="{Binding MoveSelectedPagesUpCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="â¬†" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Move Selected Down" Command="{Binding MoveSelectedPagesDownCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="â¬‡" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator/>
                                <MenuItem Header="Delete Selected" Command="{Binding DeleteSelectedPagesCommand}" InputGestureText="Del">
                                    <MenuItem.Icon>
                                        <TextBlock Text="ðŸ—‘ï¸" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Extract Selected" Command="{Binding ExtractPagesCommand}" InputGestureText="Ctrl+E">
                                    <MenuItem.Icon>
                                        <TextBlock Text="ðŸ“¤" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator/>

                                <!-- Single Page Operations -->
                                <MenuItem Header="Single Page Actions" IsEnabled="False" FontWeight="SemiBold"/>
                                <MenuItem Header="Move Up" Command="{Binding MovePageUpCommand}" InputGestureText="Ctrl+Up">
                                    <MenuItem.Icon>
                                        <TextBlock Text="^" FontWeight="Bold"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Move Down" Command="{Binding MovePageDownCommand}" InputGestureText="Ctrl+Down">
                                    <MenuItem.Icon>
                                        <TextBlock Text="v" FontWeight="Bold"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Move to First" Command="{Binding MovePageToFirstCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="|^" FontWeight="Bold"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Move to Last" Command="{Binding MovePageToLastCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="|v" FontWeight="Bold"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <Separator/>
                                <MenuItem Header="Duplicate Page" Command="{Binding DuplicatePageCommand}" InputGestureText="Ctrl+D">
                                    <MenuItem.Icon>
                                        <TextBlock Text="ðŸ“‹" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Delete Page" Command="{Binding DeletePageCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="ðŸ—‘ï¸" FontSize="12"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </ListBox.ContextMenu>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDragOver}" Value="True">
                                        <Setter Property="BorderBrush" Value="#2196F3"/>
                                        <Setter Property="BorderThickness" Value="0,2,0,0"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsDragging}" Value="True">
                                        <Setter Property="Opacity" Value="0.5"/>
                                    </DataTrigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="8" Padding="4" 
                                        CornerRadius="4"
                                        BorderThickness="2">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="White"/>
                                            <Setter Property="BorderBrush" Value="#BDBDBD"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter Property="BorderBrush" Value="#2196F3"/>
                                                    <Setter Property="Background" Value="#E3F2FD"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <!-- Selection indicator -->
                                        <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                                                Background="#2196F3" CornerRadius="0,0,4,0"
                                                Padding="4,2" Margin="-4,-4,0,0"
                                                Visibility="{Binding IsSelected, Converter={StaticResource BoolToVisibility}}">
                                            <TextBlock Text="âœ“" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                        </Border>
                                        <StackPanel>
                                            <Image Source="{Binding Thumbnail}" 
                                                   MaxWidth="160" MaxHeight="160"
                                                   Stretch="Uniform"
                                                   RenderTransformOrigin="0.5,0.5">
                                                <Image.RenderTransform>
                                                    <RotateTransform Angle="{Binding RotationAngle}"/>
                                                </Image.RenderTransform>
                                            </Image>
                                            <TextBlock Text="{Binding PageNumber, StringFormat='Page {0}'}" 
                                                       HorizontalAlignment="Center"
                                                       FontSize="11" Margin="0,4,0,0"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- Splitter Left -->
            <GridSplitter Grid.Column="1" x:Name="LeftSplitter" Width="4" HorizontalAlignment="Center" 
                          VerticalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- PDF Viewer Area with Tab Bar -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Tab Bar (visible when documents are open) -->
                <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" 
                        BorderBrush="#E0E0E0" BorderThickness="0,0,0,1"
                        Visibility="{Binding HasOpenDocuments, Converter={StaticResource BoolToVisibility}}">
                    <DockPanel>
                        <!-- Tab actions on the right -->
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Margin="4,0">
                            <Button Style="{StaticResource ToolbarButton}" 
                                    Command="{Binding CloseAllDocumentsCommand}"
                                    ToolTip="Close All Documents"
                                    Visibility="{Binding HasMultipleDocuments, Converter={StaticResource BoolToVisibility}}"
                                    Padding="6,4">
                                <TextBlock Text="âœ• All" FontSize="11"/>
                            </Button>
                        </StackPanel>
                        
                        <!-- Tab list -->
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Disabled"
                                      Padding="4,2">
                            <ItemsControl ItemsSource="{Binding OpenDocuments}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border x:Name="TabBorder" Margin="0,2,2,2" Padding="8,4" 
                                                CornerRadius="4,4,0,0" Cursor="Hand"
                                                MouseLeftButtonDown="TabItem_MouseLeftButtonDown">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#E8E8E8"/>
                                                    <Setter Property="BorderBrush" Value="#D0D0D0"/>
                                                    <Setter Property="BorderThickness" Value="1,1,1,0"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                            <Setter Property="Background" Value="White"/>
                                                            <Setter Property="BorderBrush" Value="#2196F3"/>
                                                        </DataTrigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#F5F5F5"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <!-- Document icon -->
                                                <TextBlock Grid.Column="0" Text="ðŸ“„" FontSize="12" 
                                                           VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                
                                                <!-- File name -->
                                                <TextBlock Grid.Column="1" 
                                                           Text="{Binding DisplayName}" 
                                                           VerticalAlignment="Center"
                                                           MaxWidth="150" TextTrimming="CharacterEllipsis"
                                                           ToolTip="{Binding FilePath}">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="FontWeight" Value="Normal"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                
                                                <!-- Close button -->
                                                <Button Grid.Column="2" 
                                                        Content="âœ•" FontSize="10"
                                                        Command="{Binding DataContext.CloseDocumentCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Margin="8,0,0,0" Padding="4,2"
                                                        VerticalAlignment="Center"
                                                        ToolTip="Close this document">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Background" Value="Transparent"/>
                                                            <Setter Property="BorderThickness" Value="0"/>
                                                            <Setter Property="Cursor" Value="Hand"/>
                                                            <Setter Property="Opacity" Value="0.6"/>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Opacity" Value="1"/>
                                                                    <Setter Property="Background" Value="#FFE0E0"/>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </DockPanel>
                </Border>
                
                <!-- PDF Viewer -->
                <Border Grid.Row="1" x:Name="PdfViewerBorder" Margin="8" Style="{StaticResource CardBorder}">
                <Grid>
                    <!-- PDF Content - Continuous Scroll View -->
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                  VerticalScrollBarVisibility="Auto"
                                  x:Name="PdfScrollViewer"
                                  PreviewMouseWheel="PdfScrollViewer_PreviewMouseWheel"
                                  ScrollChanged="PdfScrollViewer_ScrollChanged"
                                  Background="#F0F0F0">
                        <Grid HorizontalAlignment="Center">
                            <!-- All pages stacked vertically (always hidden - using single page view for annotation support) -->
                            <ItemsControl x:Name="PdfPagesContainer"
                                          ItemsSource="{Binding PageImages}"
                                          Visibility="Collapsed">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Vertical"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,8" Background="White" 
                                                BorderBrush="#BDBDBD" BorderThickness="1"
                                                HorizontalAlignment="Center">
                                            <Image Source="{Binding Image}" Stretch="None"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- Single page view with annotation support (always visible when file loaded) -->
                            <Grid x:Name="PdfContainer" 
                                  Visibility="{Binding IsFileLoaded, Converter={StaticResource BoolToVisibility}}"
                                  MouseLeftButtonDown="PdfContainer_MouseLeftButtonDown"
                                  Cursor="{Binding EditCursor}"
                                  Background="Transparent"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Top">
                                <Image x:Name="PdfImage" 
                                       Source="{Binding CurrentPageImage}"
                                       Stretch="None"/>
                                <Canvas x:Name="AnnotationCanvas"/>
                            </Grid>
                        </Grid>
                    </ScrollViewer>

                    <!-- Empty State -->
                    <StackPanel Visibility="{Binding IsFileLoaded, Converter={StaticResource InverseBoolToVisibility}}"
                                VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ“„" FontSize="64" HorizontalAlignment="Center" Opacity="0.5"/>
                        <TextBlock Text="No PDF Loaded" FontSize="18" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center" Margin="0,8,0,0"/>
                        <TextBlock Text="Click 'Open' or drag a PDF file here" FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        <Button Style="{StaticResource PrimaryButton}" 
                                Content="Open PDF" 
                                Command="{Binding OpenFileCommand}"
                                HorizontalAlignment="Center"
                                Margin="0,16,0,0"/>
                    </StackPanel>
                    
                    <!-- Edit Mode Indicator -->
                    <Border Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibility}}"
                            Background="#2196F3" CornerRadius="4"
                            Padding="12,6" HorizontalAlignment="Center" VerticalAlignment="Top"
                            Margin="0,10,0,0">
                        <TextBlock Text="{Binding EditModeMessage}" Foreground="White" FontWeight="Medium"/>
                    </Border>
                </Grid>
            </Border>
            </Grid>

            <!-- Splitter Right -->
            <GridSplitter Grid.Column="3" x:Name="RightSplitter" Width="4" HorizontalAlignment="Center" 
                          VerticalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- Properties Sidebar -->
            <Border Grid.Column="4" x:Name="RightPanel" Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="#E0E0E0" BorderThickness="1,0,0,0">
                <DockPanel>
                    <!-- Header -->
                    <TextBlock DockPanel.Dock="Top" Text="Elements &amp; Properties" FontWeight="SemiBold" 
                               Padding="12,8" Background="#F0F0F0"/>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Elements List -->
                        <DockPanel Grid.Row="0">
                            <TextBlock DockPanel.Dock="Top" Text="Added Elements" FontWeight="Medium"
                                       Padding="12,8,12,4" Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11"/>
                            <ListBox ItemsSource="{Binding Annotations}" 
                                     SelectedItem="{Binding SelectedAnnotation}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Margin="8,0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="8,6" Margin="0,2" CornerRadius="4"
                                                Background="{Binding IsSelected, Converter={StaticResource BoolToHighlightBrush}}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding IconEmoji}" 
                                                           FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DisplayName}" FontWeight="Medium"
                                                               TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Text="{Binding PageNumber, StringFormat='Page {0}'}" 
                                                               FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                                <Button Grid.Column="2" Content="âœ•" 
                                                        Style="{StaticResource ToolbarButton}"
                                                        Padding="4,2"
                                                        Command="{Binding DataContext.DeleteAnnotationCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        ToolTip="Delete"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </DockPanel>

                        <!-- Properties Panel -->
                        <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" 
                                Padding="12" MinHeight="200">
                            <StackPanel>
                                <TextBlock Text="Properties" FontWeight="Medium" Margin="0,0,0,12"
                                           Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>

                                <!-- No Selection State -->
                                <TextBlock Text="Select an element to edit properties"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontStyle="Italic" TextWrapping="Wrap"
                                           Visibility="{Binding HasSelectedAnnotation, Converter={StaticResource InverseBoolToVisibility}}"/>

                                <!-- Text Properties -->
                                <StackPanel Visibility="{Binding IsTextSelected, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock Text="Text Content" FontSize="11" Margin="0,0,0,4"/>
                                    <TextBox Text="{Binding SelectedTextAnnotation.Text, UpdateSourceTrigger=PropertyChanged}"
                                             TextWrapping="Wrap" AcceptsReturn="True" Height="60" Margin="0,0,0,12"/>

                                    <TextBlock Text="Font Family" FontSize="11" Margin="0,0,0,4"/>
                                    <ComboBox ItemsSource="{Binding FontFamilies}"
                                              SelectedItem="{Binding SelectedTextAnnotation.FontFamily, Mode=TwoWay}"
                                              Margin="0,0,0,8"/>

                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="Font Size" FontSize="11" Margin="0,0,0,4"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <ComboBox Grid.Column="0" 
                                                          ItemsSource="{Binding FontSizes}"
                                                          IsEditable="True"
                                                          Text="{Binding SelectedTextAnnotation.FontSize, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"/>
                                                <TextBlock Grid.Column="1" Text="pt" VerticalAlignment="Center" Margin="4,0,0,0" 
                                                           Foreground="{StaticResource TextSecondaryBrush}" FontSize="10"/>
                                            </Grid>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Text Color" FontSize="11" Margin="0,0,0,4"/>
                                            <ComboBox ItemsSource="{Binding TextColors}"
                                                      SelectedItem="{Binding SelectedTextAnnotation.Color, Mode=TwoWay}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="16" Height="16" Margin="0,0,4,0"
                                                                       Fill="{Binding Converter={StaticResource HexToColorConverter}}"/>
                                                            <TextBlock Text="{Binding}" FontSize="10"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Text Style Options -->
                                    <TextBlock Text="Text Style" FontSize="11" Margin="0,0,0,4"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <CheckBox Content="Bold" IsChecked="{Binding SelectedTextAnnotation.IsBold, Mode=TwoWay}" Margin="0,0,12,0"/>
                                        <CheckBox Content="Italic" IsChecked="{Binding SelectedTextAnnotation.IsItalic, Mode=TwoWay}" Margin="0,0,12,0"/>
                                        <CheckBox Content="Underline" IsChecked="{Binding SelectedTextAnnotation.IsUnderline, Mode=TwoWay}"/>
                                    </StackPanel>

                                    <!-- Text Alignment -->
                                    <TextBlock Text="Text Alignment" FontSize="11" Margin="0,0,0,4"/>
                                    <ComboBox ItemsSource="{Binding TextAlignments}"
                                              SelectedItem="{Binding SelectedTextAnnotation.TextAlignment, Mode=TwoWay}"
                                              Margin="0,0,0,8"/>

                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="Background" FontSize="11" Margin="0,0,0,4"/>
                                            <ComboBox ItemsSource="{Binding BackgroundColors}"
                                                      SelectedItem="{Binding SelectedTextAnnotation.BackgroundColor, Mode=TwoWay}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="16" Height="16" Margin="0,0,4,0"
                                                                       Fill="{Binding Converter={StaticResource HexToColorConverter}}"
                                                                       Stroke="Gray" StrokeThickness="0.5"/>
                                                            <TextBlock Text="{Binding}" FontSize="10"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Border Color" FontSize="11" Margin="0,0,0,4"/>
                                            <ComboBox ItemsSource="{Binding BackgroundColors}"
                                                      SelectedItem="{Binding SelectedTextAnnotation.BorderColor, Mode=TwoWay}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="16" Height="16" Margin="0,0,4,0"
                                                                       Fill="{Binding Converter={StaticResource HexToColorConverter}}"
                                                                       Stroke="Gray" StrokeThickness="0.5"/>
                                                            <TextBlock Text="{Binding}" FontSize="10"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="Border Width" FontSize="11" Margin="0,0,0,4"/>
                                    <ComboBox ItemsSource="{Binding StrokeWidths}"
                                              SelectedItem="{Binding SelectedTextAnnotation.BorderWidth, Mode=TwoWay}"
                                              Margin="0,0,0,8"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="X Position" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedTextAnnotation.X, StringFormat=F1, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Y Position" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedTextAnnotation.Y, StringFormat=F1, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                                <!-- Image Properties -->
                                <StackPanel Visibility="{Binding IsImageSelected, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock Text="Image File" FontSize="11" Margin="0,0,0,4"/>
                                    <TextBlock Text="{Binding SelectedImageAnnotation.ImagePath}" 
                                               TextTrimming="CharacterEllipsis" Margin="0,0,0,12"
                                               ToolTip="{Binding SelectedImageAnnotation.ImagePath}"/>

                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="Width" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedImageAnnotation.Width, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Height" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedImageAnnotation.Height, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="X Position" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedImageAnnotation.X, StringFormat=F1, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Y Position" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedImageAnnotation.Y, StringFormat=F1, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                                <!-- Shape Properties -->
                                <StackPanel Visibility="{Binding IsShapeSelected, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock Text="Shape Type" FontSize="11" Margin="0,0,0,4"/>
                                    <ComboBox ItemsSource="{Binding ShapeTypes}"
                                              SelectedItem="{Binding SelectedShapeAnnotation.ShapeType, Mode=TwoWay}"
                                              Margin="0,0,0,8"/>

                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="Fill Color" FontSize="11" Margin="0,0,0,4"/>
                                            <ComboBox ItemsSource="{Binding BackgroundColors}"
                                                      SelectedItem="{Binding SelectedShapeAnnotation.FillColor, Mode=TwoWay}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="16" Height="16" Margin="0,0,4,0"
                                                                       Fill="{Binding Converter={StaticResource HexToColorConverter}}"
                                                                       Stroke="Gray" StrokeThickness="0.5"/>
                                                            <TextBlock Text="{Binding}" FontSize="10"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Stroke Color" FontSize="11" Margin="0,0,0,4"/>
                                            <ComboBox ItemsSource="{Binding TextColors}"
                                                      SelectedItem="{Binding SelectedShapeAnnotation.StrokeColor, Mode=TwoWay}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Rectangle Width="16" Height="16" Margin="0,0,4,0"
                                                                       Fill="{Binding Converter={StaticResource HexToColorConverter}}"/>
                                                            <TextBlock Text="{Binding}" FontSize="10"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="Stroke Width" FontSize="11" Margin="0,0,0,4"/>
                                    <ComboBox ItemsSource="{Binding StrokeWidths}"
                                              SelectedItem="{Binding SelectedShapeAnnotation.StrokeWidth, Mode=TwoWay}"
                                              Margin="0,0,0,8"/>

                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="Width" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedShapeAnnotation.Width, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Height" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedShapeAnnotation.Height, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                            <TextBlock Text="X Position" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedShapeAnnotation.X, StringFormat=F1, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                            <TextBlock Text="Y Position" FontSize="11" Margin="0,0,0,4"/>
                                            <TextBox Text="{Binding SelectedShapeAnnotation.Y, StringFormat=F1, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Action Buttons -->
                        <Border Grid.Row="2" Padding="12" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
                            <StackPanel>
                                <Button Style="{StaticResource PrimaryButton}" 
                                        Content="Apply Changes" 
                                        Command="{Binding ApplyChangesCommand}"
                                        HorizontalAlignment="Stretch"/>
                                <Button Style="{StaticResource SecondaryButton}" 
                                        Content="Delete Selected" 
                                        Command="{Binding DeleteSelectedCommand}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,4,0,0"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </DockPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" 
                BorderBrush="#E0E0E0" BorderThickness="0,1,0,0"
                Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" 
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1" Text="{Binding FilePath}" 
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center" Margin="16,0"
                           MaxWidth="300" TextTrimming="CharacterEllipsis"/>

                <TextBlock Grid.Column="2" 
                           Text="{Binding CurrentPageNumber, StringFormat='Page {0}'}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center" Margin="16,0"
                           Visibility="{Binding IsFileLoaded, Converter={StaticResource BoolToVisibility}}"/>

                <TextBlock Grid.Column="3" 
                           Text="{Binding ZoomLevel, StringFormat='Zoom: {0}'}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center" Margin="16,0"
                           Visibility="{Binding IsFileLoaded, Converter={StaticResource BoolToVisibility}}"/>

                <TextBlock Grid.Column="4" 
                           Text="{Binding Annotations.Count, StringFormat='{}{0} elements'}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center" Margin="16,0"
                           Visibility="{Binding IsFileLoaded, Converter={StaticResource BoolToVisibility}}"/>

                <!-- Presentation Mode Button -->
                <Button Grid.Column="5" 
                        x:Name="PresentationButton"
                        Click="PresentationButton_Click"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="Presentation Mode (F5)"
                        Padding="8,4" Margin="0">
                    <TextBlock x:Name="PresentationIcon" Text="ðŸ–¥ï¸" FontSize="16"/>
                </Button>
            </Grid>
        </Border>

        <!-- Presentation Mode Overlay (hidden by default) -->
        <Grid x:Name="PresentationOverlay" Grid.RowSpan="4" Background="Black" Visibility="Collapsed" 
              MouseLeftButtonDown="PresentationOverlay_MouseLeftButtonDown"
              MouseRightButtonDown="PresentationOverlay_MouseRightButtonDown">
            <Grid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Previous Page" Click="PresentationPrevPage_Click" InputGestureText="â†"/>
                    <MenuItem Header="Next Page" Click="PresentationNextPage_Click" InputGestureText="â†’"/>
                    <Separator/>
                    <MenuItem Header="Exit Presentation" Click="PresentationExit_Click" InputGestureText="Esc"/>
                </ContextMenu>
            </Grid.ContextMenu>
            
            <!-- PDF Image centered -->
            <Image x:Name="PresentationImage" 
                   Stretch="Uniform"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
            
            <!-- Page indicator at bottom -->
            <Border Background="#80000000" CornerRadius="4" Padding="12,6"
                    HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,20"
                    x:Name="PresentationPageIndicator">
                <TextBlock x:Name="PresentationPageText" Foreground="White" FontSize="14"/>
            </Border>
            
            <!-- Help text -->
            <TextBlock Text="Click: Next | Right-click: Menu | â†â†’: Navigate | Esc: Exit" 
                       Foreground="#80FFFFFF" FontSize="12"
                       HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,60"/>
        </Grid>
    </Grid>
</Window>
