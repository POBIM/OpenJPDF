<Window x:Class="OpenJPDF.Views.ExtractPagesDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Extract Pages"
        Height="500" Width="700"
        WindowStartupLocation="CenterOwner"
        MinHeight="400" MinWidth="500"
        ShowInTaskbar="False">

    <Window.Resources>
        <Style x:Key="ReorderButton" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Left Panel: Available Pages -->
        <TextBlock Grid.Column="0" Grid.Row="0" Text="Available Pages" FontWeight="SemiBold" Margin="0,0,0,8"/>
        <Border Grid.Column="0" Grid.Row="1" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="4">
            <ListBox x:Name="AvailablePagesListBox"
                     SelectionMode="Extended"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="4" Padding="4" Background="#F8F8F8" CornerRadius="4">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="{Binding Thumbnail}"
                                       Width="60" Height="80"
                                       Stretch="Uniform"
                                       Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding PageNumber, StringFormat='Page {0}'}"
                                           VerticalAlignment="Center"
                                           FontWeight="Medium"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Border>

        <!-- Center: Add/Remove Buttons -->
        <StackPanel Grid.Column="1" Grid.Row="1" VerticalAlignment="Center" Margin="8">
            <Button Content="Add >" Width="70" Height="28" Margin="0,4" Click="Add_Click" ToolTip="Add selected pages"/>
            <Button Content="Add All >>" Width="70" Height="28" Margin="0,4" Click="AddAll_Click" ToolTip="Add all pages"/>
            <Button Content="&lt; Remove" Width="70" Height="28" Margin="0,4" Click="Remove_Click" ToolTip="Remove selected pages"/>
            <Button Content="&lt;&lt; Clear" Width="70" Height="28" Margin="0,4" Click="Clear_Click" ToolTip="Clear all"/>
        </StackPanel>

        <!-- Right Panel: Selected Pages (Reorderable) -->
        <TextBlock Grid.Column="2" Grid.Row="0" Text="Pages to Extract (Drag to reorder)" FontWeight="SemiBold" Margin="0,0,0,8"/>
        <Grid Grid.Column="2" Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="4">
                <ListBox x:Name="SelectedPagesListBox"
                         SelectionMode="Extended"
                         AllowDrop="True"
                         PreviewMouseLeftButtonDown="SelectedPages_PreviewMouseLeftButtonDown"
                         PreviewMouseMove="SelectedPages_PreviewMouseMove"
                         Drop="SelectedPages_Drop"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="4" Padding="4" Background="#E8F4E8" CornerRadius="4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Order, StringFormat='#{0}'}"
                                               Width="28"
                                               VerticalAlignment="Center"
                                               FontWeight="Bold"
                                               Foreground="#666666"/>
                                    <Image Source="{Binding Thumbnail}"
                                           Width="50" Height="65"
                                           Stretch="Uniform"
                                           Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding PageNumber, StringFormat='Page {0}'}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>

            <!-- Reorder Buttons -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="4,0,0,0">
                <Button Style="{StaticResource ReorderButton}" Content="&#x25B2;" Click="MoveUp_Click" ToolTip="Move Up"/>
                <Button Style="{StaticResource ReorderButton}" Content="&#x25BC;" Click="MoveDown_Click" ToolTip="Move Down"/>
                <Button Style="{StaticResource ReorderButton}" Content="&#x25B2;&#x25B2;" Click="MoveToTop_Click" ToolTip="Move to Top" FontSize="10"/>
                <Button Style="{StaticResource ReorderButton}" Content="&#x25BC;&#x25BC;" Click="MoveToBottom_Click" ToolTip="Move to Bottom" FontSize="10"/>
            </StackPanel>
        </Grid>

        <!-- Bottom: Buttons -->
        <StackPanel Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="2"
                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <TextBlock x:Name="StatusText" VerticalAlignment="Center" Margin="0,0,16,0" Foreground="#666666"/>
            <Button Content="Cancel" Width="80" Height="28" Margin="0,0,8,0" Click="Cancel_Click"/>
            <Button Content="Extract" Width="80" Height="28" Click="Extract_Click" IsDefault="True"/>
        </StackPanel>
    </Grid>
</Window>
